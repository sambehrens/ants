<html>
<head>
	<title>SparDrawersEpilepticDrools</title>
	<link rel="stylesheet" href="css/style.css">
    <link href='https://fonts.googleapis.com/css?family=Orbitron:400,900' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Bree+Serif' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Trade+Winds' rel='stylesheet' type='text/css'>
</head>
<audio id="audio">
</audio>
<body background="images/background.png">
    <div id="menu">
        <ul id="wrapper">
            <li>
                <input id="enterName" type="text" value="" title="Come on, be creative" placeHolder="Nick" maxlength="15" spellcheck="false">
            </li>
            <li>
                <input id="enterNumPlayers" type="text" value="" placeHolder="Number of players 2-3" maxlength="1">
            </li>
            <li>
                <select id="player" class="noselect"></select>
            </li>
            <li>
                <select id="biome" class="noselect">
                    <option>Forest</option>
                    <option>Desert</option>
                    <option>Mountain</option>
                </select>
            </li>
            <li>
                <button id="proceed" class="noselect">Next</button>
            </li>
        </ul>
    </div>
    <div id="statBar" class="noselect"> <!-- Stat Bar for player info and actions -->
        <div id="statHealthFill"></div> <!-- Element that gets smaller as the current player's health gets lower -->
        <h2 id="statName">Player 1</h2> <!-- Current player name -->
        <h2 id="statCharacter">Greed</h2> <!-- Current player character type -->
        <h3 id="statHealth">Health:</h3> <!-- Current player health label -->
        <div id="statHealthNumber">20</div> <!-- Current player health variable displayed -->
        <h3 id="statActions">Remaining Actions:</h3> <!-- Current player actions label -->
        <div id="statActionNumber">2</div> <!-- Current player actions variable displayed -->
        <div id="statActionButton">Roll</div> <!-- Button for proceeding though the current player's turn: Move -> End turn. -->
        <h3 id="cardShowButtonText">Show Cards</h3> <!-- Label for card show button -->
        <div id="cardShowButton" class="triangle"></div> <!-- Button for expanding the bar, showing the cards. -->
    </div>
    <canvas id="spriteCanvas"></canvas>
    <canvas id="myCanvas" resize></canvas>
    <div id="bBar">
        <div class="deck"></div>
        <div id="cards"></div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="js/paper-full.js"></script>
    <!--<script type="text/javascript" src="js/spriteAnimationCode.js"></script> -->
    <script type="text/paperscript" canvas="myCanvas">
/*
to do:
3. figure out what the hell to do with attacks

players[currentPlayer].health/players[currentPlayer].character.health
*/
// wrathSprite.destinationX = 900;
var audio = $("#audio")[0];
audio.setAttribute('src', "music/mainTheme.mp3");
// audio.play();
//audio.setAttribute('src', "music/victoryTheme.wav");
audio.play();

var canvas = document.getElementById('spriteCanvas');
var context = canvas.getContext('2d');

(function() {

    var lastTime = 0;
    var vendors = ['ms', 'moz', 'webkit', 'o'];
    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
        window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
        window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame'] 
                                   || window[vendors[x]+'CancelRequestAnimationFrame'];
    }
 
    if (!window.requestAnimationFrame)
        window.requestAnimationFrame = function(callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 16 - (currTime - lastTime));
            var id = window.setTimeout(function() { callback(currTime + timeToCall); }, 
              timeToCall);
            lastTime = currTime + timeToCall;
            return id;
        };
 
    if (!window.cancelAnimationFrame)
        window.cancelAnimationFrame = function(id) {
            clearTimeout(id);
        };
}());

var wrathSprite;
var greedSprite;
var prideSprite;

(function () {
      
  var wrathImage;
  var greedImage;
  var prideImage;
  var canvas;         

  function gameLoop () {
  
    window.requestAnimationFrame(gameLoop);

    wrathSprite.update();
    greedSprite.update();
    prideSprite.update();
    wrathSprite.render();
    greedSprite.render();
    prideSprite.render();
  }
  
  function sprite (options) {
  
    var that = {},
      frameIndex = 0,
      tickCount = 0,
      ticksPerFrame = options.ticksPerFrame || 0,
      numberOfFrames = options.numberOfFrames || 1;
    
    that.context = options.context;
    that.width = options.width;
    that.height = options.height;
    that.destinationX = options.destinationX;
    that.destinationY = options.destinationY;
    that.sizeWidth = options.sizeWidth;
    that.sizeHeight = options.sizeHeight;
    that.image = options.image;
    
    that.update = function () {

            tickCount += 1;

            if (tickCount > ticksPerFrame) {

        tickCount = 0;
        
                // If the current frame index is in range
                if (frameIndex < numberOfFrames - 1) {  
                    // Go to the next frame
                    frameIndex += 1;
                } else {
                    frameIndex = 0;
                }
            }
        };
    
    that.render = function () {
    
      // Clear the canvas
      that.context.clearRect(that.destinationX, that.destinationY, that.sizeWidth, that.sizeHeight);
      
      // Draw the animation
      that.context.drawImage(
        that.image,
        frameIndex * that.width / numberOfFrames,
        0, // potential for stacked spritesheet
        that.width / numberOfFrames,
        that.height,
        that.destinationX, //destination x
        that.destinationY, //destination y
        that.sizeWidth,
        that.sizeHeight,
        that.width / numberOfFrames,
        that.height);
    };
    
    return that;
  }
  
  // Get canvas
  canvas = document.getElementById("spriteCanvas");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  
  // Create sprite sheet
  wrathImage = new Image(); 
  prideImage = new Image();
  greedImage = new Image();


  wrathSprite = sprite({
    context: canvas.getContext("2d"),
    width: 3420,
    height: 158,
    destinationX: -500,
    destinationY: -500,
    sizeWidth: 110,
    sizeHeight: 90,
    image: wrathImage,
    numberOfFrames: 18,
    ticksPerFrame: 5
  });

  greedSprite = sprite({
    context: canvas.getContext("2d"),
    width: 11952,
    height: 377,
    destinationX: -500,
    destinationY: -500,
    sizeWidth: 110,
    sizeHeight: 90,
    image: greedImage,
    numberOfFrames: 18,
    ticksPerFrame: 5
  });

  prideSprite = sprite({
    context: canvas.getContext("2d"),
    width: 8676,
    height: 356,
    destinationX: -500,
    destinationY: -500,
    sizeWidth: 110,
    sizeHeight: 90,
    image: prideImage,
    numberOfFrames: 18,
    ticksPerFrame: 6
  });
  
  // Load sprite sheet
  wrathImage.addEventListener("load", gameLoop);
  greedImage.addEventListener("load", gameLoop);
  prideImage.addEventListener("load", gameLoop);
  wrathImage.src = "images/tryRun2.png";
  greedImage.src = "images/greedSprite.png";
  prideImage.src = "images/prideSprite.png";

} ());

var expanded = false; // Is the bottom bar expanded?
var numCards = 0; // number of cards
var bBarWidth = 6;// width of bottom bar for cards
var healthRatio = 1; // change in health fill on the statbar
var currentAttack = 0, currentDefense = 0;

$("#cards").hide();
$('#bBar').hide(); // hides the card holder bar
$("#statBar").hide();

function  expandBBar() {// expand the card shelf a.k.a. bottom bar

    for (var i = 0; i < players[currentPlayer].cards.length; i += 1) {// add the cards that the player has to the bbar
        $("#cards").append('<div class="cardy" id="' + players[currentPlayer].cards[i].css + '"><div id="cardLabels"><p id="attackLabel">' + players[currentPlayer].cards[i].attack + '</p> <p id="defendLabel">' + players[currentPlayer].cards[i].defend + '</p></div></div>');
    }


    $("#bBar").css("background", "#C96A4B");//set the background color to a new color
    $("#bBar").css("width", "80%");// set the wisth to expand the screen
    $("#cards").delay(680).show(680);// delay the showing of the cards
    
    $(".triangle").css("transform","rotate(30deg) skewX(-30deg) scale(1,.866)");//rotate the triangle that is for showing cards
    $("#cardShowButton").css("margin", "4.9vw 0vw 9vw 9vw")// move the show card text to be centered in the recently moved triangle
    $("#cardShowButtonText").html('Hide Cards')// set the triangles text to hide cards
    
    if (numCards >= 4) {// set the overflow so the cards can go off screen
        $("#bBar").css("overflowX", "scroll");
    }
    
    if (turnCounter === 2) {// if it is time to action, set the text to draw cards
        $("#statActionButton").html('Draw Card');
    }
    expanded = true;// set the expanded to true because the bbar is expanded
}

function hideBBar() { // hide the card cabinet a.k.a. bottom bar
    if (expanded === true) {   // if the bar is expanded
        $("#cards").delay(600).show(600).finish();//delay the showing of the cards
        $("#bBar").css("background", "#FF551C");// change the bbar color
        $("#bBar").css("width", "0");// collapse the bbar
        $("#cards").hide(0);//hide all of the cards
        $("#bBar").css("overflowX", "hidden");//hide the overflow
        for (var i = 0; i < players[currentPlayer].cards.length; i += 1) {// remove all the cards from #cards. when expanded, add them back
            $(".cardy").remove();// remve individual cards
        }
        
        $("#cardShowButton").css("margin", "3vw 0vw 9vw 7.5vw")//center the text in the triangle
        $("#cardShowButtonText").html('Show Cards')// change the text back to show cards
        
        $(".triangle").css("transform","rotate(-30deg) skewX(-30deg) scale(1,.866)");//rotate the triangle back

        if (turnCounter === 2) {// change the trext back to next turn from draw card
            $("#statActionButton").html('Next Turn');
        }
        expanded = false;// set card bar to not expanded
    }
}

$('#cardShowButton').click(function () {//this is if you click on the triangle to show cards or hide them
    "use strict";
    if (expanded === false) {

        expandBBar();//expand the card bar to show cards

    } else {

        hideBBar();//hide the card bar to hide cards

    }
});
$('#cardShowButtonText').click(function () {// this is if you click on the show card text
    "use strict";
    if (expanded === false) {

        expandBBar();//expand the card bar to show cards

    } else {

        hideBBar();//hide the card bar to hide cards

    }
});

// this block is for card clicks! do not enter. you will not come out alive
$("body").on('click', '#card1', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[0].cards[0].attack;currentDefense = playerTypes[0].cards[0].defend;this.remove();}});
$("body").on('click', '#card2', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[0].cards[1].attack;currentDefense = playerTypes[0].cards[1].defend;this.remove();}});
$("body").on('click', '#card3', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[0].cards[2].attack;currentDefense = playerTypes[0].cards[2].defend;this.remove();}});
$("body").on('click', '#card4', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[0].cards[3].attack;currentDefense = playerTypes[0].cards[3].defend;this.remove();}});
$("body").on('click', '#card5', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[0].cards[4].attack;currentDefense = playerTypes[0].cards[4].defend;this.remove();}});
$("body").on('click', '#card6', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[0].cards[5].attack;currentDefense = playerTypes[0].cards[5].defend;this.remove();}});
$("body").on('click', '#card7', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[0].cards[6].attack;currentDefense = playerTypes[0].cards[6].defend;this.remove();}});
$("body").on('click', '#card8', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[1].cards[0].attack;currentDefense = playerTypes[1].cards[0].defend;this.remove();}});
$("body").on('click', '#card9', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[1].cards[1].attack;currentDefense = playerTypes[1].cards[1].defend;this.remove();}});
$("body").on('click', '#card10', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[1].cards[2].attack;currentDefense = playerTypes[1].cards[2].defend;this.remove();}});
$("body").on('click', '#card11', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[1].cards[3].attack;currentDefense = playerTypes[1].cards[3].defend;this.remove();}});
$("body").on('click', '#card12', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[1].cards[4].attack;currentDefense = playerTypes[1].cards[4].defend;this.remove();}});
$("body").on('click', '#card13', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[1].cards[5].attack;currentDefense = playerTypes[1].cards[5].defend;this.remove();}});
$("body").on('click', '#card14', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[1].cards[6].attack;currentDefense = playerTypes[1].cards[6].defend;this.remove();}});
$("body").on('click', '#card15', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[1].cards[7].attack;currentDefense = playerTypes[1].cards[7].defend;this.remove();}});
$("body").on('click', '#card16', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[2].cards[0].attack;currentDefense = playerTypes[2].cards[0].defend;this.remove();}});
$("body").on('click', '#card17', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[2].cards[1].attack;currentDefense = playerTypes[2].cards[1].defend;this.remove();}});
$("body").on('click', '#card18', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[2].cards[2].attack;currentDefense = playerTypes[2].cards[2].defend;this.remove();}});
$("body").on('click', '#card19', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[2].cards[3].attack;currentDefense = playerTypes[2].cards[3].defend;this.remove();}});
$("body").on('click', '#card20', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[2].cards[4].attack;currentDefense = playerTypes[2].cards[4].defend;this.remove();}});
$("body").on('click', '#card21', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[2].cards[5].attack;currentDefense = playerTypes[2].cards[5].defend;this.remove();}});
$("body").on('click', '#card22', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[2].cards[6].attack;currentDefense = playerTypes[2].cards[6].defend;this.remove();}});
$("body").on('click', '#card23', function () {if (turnCounter === 2 && cardSelected === false && actionCounter !== 0) {cardSelected = true;currentAttack = playerTypes[2].cards[7].attack;currentDefense = playerTypes[2].cards[7].defend;this.remove();}});


//var scrollW = document.getElementsByClassName("");
function addCard() {// add card to youtr hand and have it show up in thr bbar
    "use strict";
    if (numCards < 10 && actionCounter > 0 && turnCounter === 2) {
        numCards += 1;

        var randomCardIndex = Math.floor((Math.random() * (players[currentPlayer].character.cards.length -1)));
        
        //add a card li to the cards div
        $("#cards").append('<div class="cardy" id="' + players[currentPlayer].character.cards[randomCardIndex].css + '"><div id="cardLabels"><p id="attackLabel">' + players[currentPlayer].character.cards[randomCardIndex].attack + '</p> <p id="defendLabel">' + players[currentPlayer].character.cards[randomCardIndex].defend + '</p></div></div>');

        
        //extend bar width
        bBarWidth += (players[currentPlayer].cards.length * 1.4 + 8);
        $("#cards").css("width", bBarWidth + "vw");
        
        if (numCards >= 4) {
            $("#bBar").css("overflowX", "scroll");
        }

        players[currentPlayer].cards.push(players[currentPlayer].character.cards[randomCardIndex]);// add new random card to players hand

        actionCounter -= 1;// you lose an action because drawing a card takes an action
        $("#statActionNumber").html(actionCounter);// update the action counter
    }
}

var actionJustSwitched = true;// if an action was just switched, this keeps track

$("#statActionButton").click(function () {// this is the main gameplay button
    
     if ($("#statActionButton").html() !== "Draw Card") {//if it isnt time to draw a card
        turnCounter++;// add to the turn counter so we know what part of the turn it is
        if (turnCounter === 2) {
            actionJustSwitched = true;
        }
     }

    if (turnCounter === 3) { // next players turn !!!!!!!!!!!!!!!!!!!!!!

        for (var i = 0; i < size; i += 1) {//  clearing the highlights at end of turn
            for (var ii = 0; ii < size; ii += 1) {

                boardMain[i][ii].backgroundPath.visible = false; // reset all tiles to non movable

            }
        }

        hideBBar();// hide the card bar when it is the next players turn

        currentPlayer++;// set the current player to the next person
        if (currentPlayer === players.length) {// if the next person desn't exist, switch it back to the first player
            currentPlayer = 0;// first player
        }

        //hideBBar();

        turnCounter = 0;// rest the turn counter

        currentAttack = 0;// reset the attack variabe
        currentDefense = 0;// reset the defense variable

        numCards = players[currentPlayer].cards.length;// set the number of cards to the current players amount of cards
        actionCounter = players[currentPlayer].character.numActions;// set the action counter to the current player number of actions

        cardSelected = false;// set the checer for card selected to false

        healthRatio = players[currentPlayer].health / players[currentPlayer].character.health;// the ratio of health to available health
        $("#statHealthFill").css("transition", "top: 2s");// set the stat bars red to the amount of health
        $("#statHealthFill").css("top", ((1 - healthRatio)  * 100) + '%'); //slowly shifts red health fill downwards in sync with 

        $("#statName").html(players[currentPlayer].nick);// change the name in the sta bar to the currnet players name
        $("#statActionNumber").html(actionCounter);
        $("#statHealthNumber").html(players[currentPlayer].health);
        //$("#statName").html(players[currentPlayer].nick);
        $("#statCharacter").html(players[currentPlayer].character.type);

    } else if (turnCounter === 1) {
        moveCounter = Math.floor((Math.random() * players[currentPlayer].character.dice) + 1);
    }

    if (turnCounter === 0) {
        $("#statActionButton").html('Roll');
    } else if (turnCounter === 1) {
        $("#statActionButton").html('Action');
    } else if (turnCounter === 2) {
        
        if (expanded === true) {
            $("#statActionButton").html('Draw Card');
            if (actionJustSwitched === false) {
                addCard();
            }
        } else {
            $("#statActionButton").html('Next Turn');
        }
        actionJustSwitched = false;
    }
    for (var i = 0; i < size; i += 1) {//just trying to see where i can go
        for (var ii = 0; ii < size; ii += 1) {
            //   move events here

            boardMain[i][ii].backgroundPath.visible = false; // reset all tiles to non movable, then set them to movable don there\/

            if (turnCounter === 1) { // if in the move phase
                if (canPlayerMoveOrNah(ii,i)) {// shows you where you can move on the map

                    boardMain[i][ii].backgroundPath.visible = true;//  can move here

                } 
            }
        }
    }
});
    
$("#myCanvas").hide();


var size, biome, playerType, numPlayers = 30, gameSetup = 1, players = [], move = false, currentPlayer = 0, turnCounter = 0, moveCounter = 0, cardSelected = false, dragging = false;

var playerTypes = [// array of player types: add new player types here
    {
        type: 'Greed',
        sprite: greedSprite,// the player sprite
        dice: 12,//the max a man can move
        health: 20,// the haelth at the beginning of the game
        numActions: 3,// the num actions givent o the player
        cards: [// array of cards: put new cards here
            {attack: 4,defend: 2,move: 5,count: 6, css: "card1"},
            {attack: 5,defend: 1,count: 4, css: "card2"},
            {attack: 6,defend: 0,count: 2, css: "card3"},
            {attack: 3,defend: 4,count: 5, css: "card4"},
            {attack: 3,defend: 0,count: 3, css: "card5"},
            {attack: 4,defend: 5,count: 2, css: "card6"},
            {attack: 0,defend: 5,count: 3, css: "card7"}
        ]
    },
    {
        type: 'Wrath',
        sprite: wrathSprite,// the player sprite
        dice: 4,//the max a man can move
        health: 16,// the haelth at the beginning of the game
        numActions: 2,// the num actions givent o the player
        cards: [// array of cards: put new cards here
            {attack: 8,defend: 0,count: 2, css: "card8"},
            {attack: 4,defend: 1,count: 5, css: "card9"},
            {attack: 3,defend: 2,count: 7, css: "card10"},
            {attack: 0,defend: 4,count: 3, css: "card11"},
            {attack: 5,defend: 0,count: 3, css: "card12"},
            {attack: 6,defend: 0,count: 1, css: "card13"},
            {attack: 3,defend: 0,pierce: true,count: 3, css: "card14"},
            {attack: 3,defend: 3,pierce: true,count: 1, css: "card15"}
        ]
    },
    {
        type: 'Pride',
        sprite: prideSprite,// the player sprite
        dice: 8,//the max a man can move
        health: 22,// the haelth at the beginning of the game
        numActions: 2,// the num actions givent o the player
        cards: [// array of cards: put new cards here
            {attack: 8,defend: 0,count: 2, css: "card16"},
            {attack: 0,defend: 7,count: 3, css: "card17"},
            {attack: 5,defend: 2,count: 5, css: "card18"},
            {attack: 3,defend: 2,count: 4, css: "card19"},
            {attack: 2,defend: 3,count: 4, css: "card20"},
            {attack: 0,defend: 0,heal: 8,count: 2, css: "card21"},
            {attack: 0,defend: 0,heal: 2,count: 1, css: "card22"},
            {attack: 4,defend: 4,count: 4, css: "card23"}
        ]
    }
];


$("#player").hide(); // hide the player selector
$("#enterName").hide();// hide the name enterer

$("#proceed").click(function() {// the main setup button function
    playerType = $("#player").val();// set players type to the selected type
    biome = $("#biome").val();// set the biome to the selected type

    if (numPlayers === gameSetup) {// if all game setup is gone, set the text to start the game
        $("#proceed").html('Start Game');
    }

    if (gameSetup === 1) {//
        $("#enterNumPlayers").hide();
        $("#biome").hide();

        numPlayers = $("#enterNumPlayers").val();// taking in the number of players
        numPlayers = parseInt(numPlayers,10);
        size = 3 + (numPlayers * 2);//  scaling the size of map to the number of players

        $("#player").show();
        $("#enterName").show();
    }

    if (gameSetup > 1) {

        var xSpawn = 6, ySpawn = 6; //  coords where players spawn

        if (numPlayers === 2) {
            if (gameSetup === 2) {
                xSpawn = 4;
                ySpawn = 1;
            } else {
                xSpawn = 2;
                ySpawn = 5;
            }
        } else if (numPlayers === 3) {
            if (gameSetup === 2) {
                xSpawn = 4;
                ySpawn = 1;
            } else if (gameSetup === 3) {
                xSpawn = 7;
                ySpawn = 4;
            } else {
                xSpawn = 1;
                ySpawn = 7;
            }
        } else if (numPlayers === 4) {
            if (gameSetup === 2) {
                xSpawn = 5;
                ySpawn = 1;
            } else if (gameSetup === 3) {
                xSpawn = 9;
                ySpawn = 2;
            } else if (gameSetup === 4) {
                xSpawn = 1;
                ySpawn = 9;
            } else {
                xSpawn = 6;
                ySpawn = 8;
            }
        }

        player = {
            nick: $("#enterName").val(),
            character: playerTypes[$("#player option:selected").index()],
            coord: {
                x: xSpawn,//   x coord of where player spawns
                y: ySpawn //   y coord of where player spawns
            },
            sprite: wrathSprite,
            cards: [],//    put cards that the player can gets in this array
            health: playerTypes[$("#player option:selected").index()].health,
            // healthFromLastTurn: 1, // ratio of health that the player had at the start of their previous turn
            nameLabel: new PointText() //   name label
        };
        if (player.nick === '') {
            player.nick = 'Player ' + (gameSetup-1); // if no nickname is entered, they get assigne a player number
        }

        players.push(player);

        playerTypes.splice($("#player option:selected").index(),1);
        for (var i = 0; i < playerTypes.length + 1; i += 1) {
            $(".playerTypes").remove();
        }
        for (var i = 0; i < playerTypes.length; i += 1) {//   add player types to select option in html code
            $("#player").append("<option class='playerTypes'>" + playerTypes[i].type + "</option>");
        }
        console.log("playertypes length: " + playerTypes.length)

    }


    if (numPlayers + 1 === gameSetup) {
        $("body").css('background-image', 'none');
        $("#menu").hide();
        $("#myCanvas").fadeToggle("slow");
        $('#bBar').show('slow');
        $("#statBar").show();
        actionCounter = players[currentPlayer].character.numActions;
        $("#statActionNumber").html(actionCounter);
        $("#statHealthNumber").html(players[currentPlayer].health);
        $("#statName").html(players[currentPlayer].nick);
        $("#statCharacter").html(players[currentPlayer].character.type);
        setup();
    }

    $("#enterName").val('');

    gameSetup += 1;
});



for (var i = 0; i < playerTypes.length; i += 1) {//   add player types to select option in html code
    $("#player").append("<option class='playerTypes'>" + playerTypes[i].type + "</option>");
}


//wrathSprite.destinationX = 500;

var boardMain = [];

var paralaxReady = false;
var count = 50;

function setup() {//           setup map here, also draw it


    // this is the paralax code -------------

    // Create a symbol, which we will use to place instances of later:
    var path = new Path.Circle({
        center: [0, 0],
        radius: 10,
        fillColor: 'blue'
    });

    var symbol = new Symbol(path);

    // Place the instances of the symbol:
    for (var i = 0; i < count; i++) {
        // The center position is a random point in the view:
        var center = Point.random() * view.size;
        var placedSymbol = symbol.place(center);
        placedSymbol.scale(i / count);
    }
    paralaxReady = true;
    // end paralax code -----------------------

    var x = 200,y = 100;
    var topLeft = -1;
    var bottomRight = -size;
    for (var i = 0; i < size; i += 1) {
        var row = [];
        topLeft++;
        bottomRight++;
        for (var ii = 0; ii < size; ii += 1) {

            var type = randomTileType();

            if (ii < ((size-1)/2)-topLeft && i < ((size-1)/2)){    //this removes the top left corner to make the board a hexagon
              
                var raster = new Raster({ // a raster is just an image and this is where the tile images are made ;)
                    position: new Point(20000,y),
                    source: imagePicker(type)
                })

                var circle = new Shape.Circle(new Point(20000,y), 60);//circle for in front of image
                circle.fillColor = new Color(0.5,0.5,05,0.3);
                circle.visible = false;
           
            } else if (ii > ((size - ((size-1)/2))-1)-bottomRight && i > ((size - ((size-1)/2))-1)){  //this removes the bottom right corner
               
                var raster = new Raster({ // a raster is just an image and this is where the tile images are made ;)
                    position: new Point(20000,y),
                    source: imagePicker(type)
                })

                var circle = new Shape.Circle(new Point(20000,y), 60);//circle for in front of image
                circle.fillColor = new Color(0.5,0.5,05,0.3);
                circle.visible = false;
            
            } else {
                var raster = new Raster({ // a raster is just an image and this is where the tile images are made ;)
                    position: new Point(x,y),
                    source: imagePicker(type)
                })

                var circle = new Path.RegularPolygon(new Point(x,y),6, 64);//circle for in front of image
                circle.fillColor = new Color((22/255),(240/255),(80/255),0.3);
                circle.visible = false;
            }

            var hexObject = {
                x: x, // x coord in pixels
                y: y, // y coord in pixels
                radius: 50, // radius of tile, i need to remember why we need this
                type: type, // type of tile i.e. forest, mountain
                path: raster, // image
                backgroundPath: circle // circle for in front of image
            };

            row.push(hexObject);
            x += 110;
        }
        boardMain.push(row);
        y += 95;
        x = (200-5*(i+1)) + (i+1) * 60;
    }
    for (var i = 0; i < players.length; i += 1) {//  setup all of the images for the players including the nametag
        var xP = boardMain[players[i].coord.y][players[i].coord.x].path.position.x;
        var yP = boardMain[players[i].coord.y][players[i].coord.x].path.position.y;
        players[i].sprite = players[i].character.sprite;
        players[i].sprite.destinationX = xP - players[i].sprite.sizeWidth/2;
        players[i].sprite.destinationY = yP - players[i].sprite.sizeHeight/2;
        players[i].nameLabel = new PointText({
            point: new Point(xP,yP),
            justification: 'center',
            fontSize: 30,
            fillColor: 'white',
            fontFamily: 'Trade Winds',
            content: players[i].nick
        });
    }
    actionCounter = players[currentPlayer].character.numActions;
}

function imagePicker(type) { // choose images for tiles
    if (type === 'forest') {
        return 'images/grass.png';
    }
    else if (type === 'sand') {
        return 'images/desert.png';
    }
    else if (type === 'rock') {
        return 'images/rock.png';
    }
}


function randomTileType() { // choose a random tile type to assign to a tile
    var randomTile = Math.floor((Math.random() * 6) + 1);
    if (biome === 'Forest') {
        if (randomTile <= 4) {
            return 'forest';
        } else if (randomTile === 5) {
            return 'sand';
        } else if (randomTile === 6) {
            return 'rock';
        }
    } else if (biome === 'Desert') {
        if (randomTile <= 4) {
            return 'sand';
        } else if (randomTile === 5) {
            return 'rock';
        } else if (randomTile === 6) {
            return 'forest';
        }
    } else if (biome === 'Mountain') {
        if (randomTile <= 4) {
            return 'rock';
        } else if (randomTile === 5) {
            return 'forest';
        } else if (randomTile === 6) {
            return 'sand';
        }
    }
}

function isNegative(number) { // check if number is negative
    if (number > 0) {
        return true;
    } else if (number < 0) {
        return false;
    }
}


function isPlayerThereOrNah(x,y) { //  check if player is on a space
    for (var i = 0; i < players.length; i += 1) {
        if (players[i].coord.x === x && players[i].coord.y === y) {
            return true;
        }
    }
    return false;
}

function canPlayerMoveOrNah(x,y) { // check if player can move to a certain spot

    var deltaX = x - players[currentPlayer].coord.x;
    var deltaY = y - players[currentPlayer].coord.y;

    if (players[currentPlayer].coord.x + moveCounter >= x && 
        players[currentPlayer].coord.y + moveCounter >= y && 
        players[currentPlayer].coord.x - moveCounter <= x && 
        players[currentPlayer].coord.y - moveCounter <= y && 
        (Math.abs(deltaX) + Math.abs(deltaY) <= moveCounter || (isNegative(deltaX) !== isNegative(deltaY) && (Math.abs(deltaY) <= moveCounter || Math.abs(deltaX) <= moveCounter))) && 
        isPlayerThereOrNah(x,y) === false &&
        boardMain[y][x].type !== "rock") { //  player cannot move onto a rock space

        return true;

    } 

    return false;
}

function rangedAttack() {
    for (var i = players[currentPlayer].coord.x; i < size; i+=1) { // shoot to the right along x axis || RANGED
        if (boardMain[players[currentPlayer].coord.y][i].type === 'rock') {
            break;
        } else {
            boardMain[players[currentPlayer].coord.y][i].backgroundPath.visible = true;
        }
    }
    for (var i = players[currentPlayer].coord.x; i >= 0; i-=1) { // shoot to the left along x axis || RANGED
        if (boardMain[players[currentPlayer].coord.y][i].type === 'rock') {
            break;
        } else {
            boardMain[players[currentPlayer].coord.y][i].backgroundPath.visible = true;
        }
    }
    for (var i = players[currentPlayer].coord.y; i < size; i+=1) { // shoot down along y axis || RANGED
        if (boardMain[i][players[currentPlayer].coord.x].type === 'rock') {
            break;
        } else {
            boardMain[i][players[currentPlayer].coord.x].backgroundPath.visible = true;
        }
    }
    for (var i = players[currentPlayer].coord.y; i >= 0; i-=1) { // shoot up along y axis || RANGED
        if (boardMain[i][players[currentPlayer].coord.x].type === 'rock') {
            break;
        } else {
            boardMain[i][players[currentPlayer].coord.x].backgroundPath.visible = true;
        }
    }
    // for (var i = 0; i < (size - players[currentPlayer].coord.y); i+=1) { // shoot down along z axis || RANGED
    //     if (players[currentPlayer].coord.y + i - 1 <= size && players[currentPlayer].coord.x - i + 1 >= 0) {
    //         if (boardMain[players[currentPlayer].coord.y + i][players[currentPlayer].coord.x - i].type === 'rock') {
    //             break;
    //             Console.log(i);
    //         } else {
    //             boardMain[players[currentPlayer].coord.y + i][players[currentPlayer].coord.x - i].backgroundPath.visible = true;
    //         }
    //     }
        
    // }
    // for (var i = 0; i < (players[currentPlayer].coord.y) + 1; i+=1) { // shoot up along z axis || RANGED
    //     if (players[currentPlayer].coord.x + i <= size && players[currentPlayer].coord.y - i >= 0) {
    //         if (boardMain[players[currentPlayer].coord.y - i][players[currentPlayer].coord.x + i].type === 'rock') {
    //             break;
    //         } else {
    //             boardMain[players[currentPlayer].coord.y - i][players[currentPlayer].coord.x + i].backgroundPath.visible = true;
    //         }
    //     }
    // }
    // third axis ii - players[currentPlayer].coord.x)*(-1) === i - players[currentPlayer].coord.y
}

function statBox(player) {

}

function onFrame(event) { // runs 60 times per second TIP: Dont put a lot of loops in here because it will slow the game down a BUNCH
    if (turnCounter === 2 && cardSelected === true) {

        rangedAttack();

    }

    if (paralaxReady === true) {
        for (var i = 0; i < count; i++) {
            var item = project.activeLayer.children[i];
            
            // Move the item 1/20th of its width to the right. This way
            // larger circles move faster than smaller circles:
            item.position.x += item.bounds.width / 20;

            // If the item has left the view on the right, move it back
            // to the left:
            if (item.bounds.left > view.size.width) {
                item.position.x = -item.bounds.width;
            }
        }
    }
}

function onMouseMove(event) {
    // for (var i = 0; i < size; i += 1) {
    //     for (var ii = 0; ii < size; ii += 1) {
    //         if (boardMain[i][ii].path.contains(event.point)) {
    //             //   move events here

    //         } 
            
    //     }
    // }
}

function onMouseDrag(event) {
    //if statement about if it is too far dragged or not
    dragging = true;
    //$("#spriteCanvas").context.clearRect(0, 0, window.width, window.height);
    context.clearRect(0, 0, canvas.width, canvas.height);
    for (var i = 0; i < size; i += 1) {
        for (var ii = 0; ii < size; ii += 1) {//  reposition tiles for the draging of the map

            boardMain[i][ii].backgroundPath.position.x += event.delta.x/3; // drag circles that highlight usable tiles: x coord
            boardMain[i][ii].backgroundPath.position.y += event.delta.y/3; // y ccord

            boardMain[i][ii].path.position.x += event.delta.x/3; // drag the tiles: x coord
            boardMain[i][ii].path.position.y += event.delta.y/3; // y coord

        }
        if (i < players.length) { // just using the board checker to also check the players
            players[i].sprite.destinationX += event.delta.x/3; // move players when map is being drgged
            players[i].sprite.destinationY += event.delta.y/3;
            players[i].nameLabel.position.x += event.delta.x/3; // move the name label
            players[i].nameLabel.position.y += event.delta.y/3;
        }
    }
}

function onMouseDown(event) {
    for (var i = 0; i < size; i += 1) {
        for (var ii = 0; ii < size; ii += 1) {
            if (Math.pow(event.point.x - boardMain[i][ii].path.position.x,2) + Math.pow(event.point.y - boardMain[i][ii].path.position.y,2) < Math.pow(43,2)) {
                //click events here


                boardMain[i][ii].path.bounds.width -=10; // make the tile small when click down
                boardMain[i][ii].path.bounds.height -=10;

                boardMain[i][ii].path.position.x +=5;// reposition tile to center
                boardMain[i][ii].path.position.y +=5;
                
                console.log('x: ' + ii + '  y: ' + i);
                if (move === true) {
                    //   move math here
                }
            }
        }
    }
}

function onMouseUp(event) {

    for (var i = 0; i < size; i += 1) {
        for (var ii = 0; ii < size; ii += 1) {

            if (boardMain[i][ii].path.bounds.width < 109) {// make the tile large again

                boardMain[i][ii].path.bounds.width +=10;
                boardMain[i][ii].path.bounds.height +=10;

                boardMain[i][ii].path.position.x -=5;// reposition tile back to center
                boardMain[i][ii].path.position.y -=5;
            }

            if (Math.pow(event.point.x - boardMain[i][ii].path.position.x,2) + Math.pow(event.point.y - boardMain[i][ii].path.position.y,2) < Math.pow(43,2)) {
                //   move events here
                
                

                if (turnCounter === 1 && dragging === false) {
                    //console.log(ii + "  " + i)
                    var deltaX = ii - players[currentPlayer].coord.x;
                    var deltaY = i - players[currentPlayer].coord.y;

                    if (canPlayerMoveOrNah(ii,i)) {

                        players[currentPlayer].sprite.destinationX = boardMain[i][ii].path.position.x - players[currentPlayer].sprite.sizeWidth/2;
                        players[currentPlayer].sprite.destinationY = boardMain[i][ii].path.position.y - players[currentPlayer].sprite.sizeHeight/2;
                        players[currentPlayer].nameLabel.position = boardMain[i][ii].path.position;
                        players[currentPlayer].coord.x = ii;
                        players[currentPlayer].coord.y = i;
                        context.clearRect(0, 0, canvas.width, canvas.height);

                        moveCounter = 0;

                    } 
                }

                if (turnCounter === 2 && boardMain[i][ii].backgroundPath.visible === true && actionCounter !== 0 && dragging === false) { // this whole shabang is about attacking
                    for (var u = 0; u < players.length; u += 1) {
                        if (u !== currentPlayer) {
                            if (players[u].coord.x === ii && players[u].coord.y === i) {
                                players[u].health -= currentAttack;
                                console.log("player " + (u+1) + " loses 1 health and is at " + players[u].health + " health");
                                actionCounter -= 1;
                                $("#statActionNumber").html(actionCounter);
                                cardSelected = false;
                                // healthRatio = players[currentPlayer].health / players[currentPlayer].character.health;

                                // $("#statHealthFill").css("height", (healthRatio * 100) + '%');
                                // $("#statHealthFill").css("top", ((1 - healthRatio) * 100) +'%');

                            }
                        }
                    }
                }
            }
            if (turnCounter === 2) { 
                   //boardMain[i][ii].backgroundPath.visible = false;
            }
            if (dragging === false) {
                boardMain[i][ii].backgroundPath.visible = false; // reset all tiles to non movable
            }
        }
    }
    for (var i = 0; i < players.length; i += 1) {
        if (players[i].health <= 0) {
            players.splice(i,1);
            numPlayers--;
        }
    }
    if (players.length === 1) {
        $("canvas").fadeToggle("slow");
        $("#statBar").hide();
        hideBBar();
        $("body").append("<div id='winScreen'>" + players[0].nick + " Wins!<p id='clickContinue'>Click to continue</p></div>");
        $("body").css("background","black");
        document.cookie = players[0].nick + " was the last winner!";
    }
    dragging = false;
}

$("body").on('click', '#winScreen', function () {
    location.reload();
    consol.log("reload");
});
    </script>
</body>
</html>
