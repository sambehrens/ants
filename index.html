<html>
<head>
	<title>SparDrawersEpilepticDrools</title>
	<link rel="stylesheet" href="css/style.css">
    <link href='https://fonts.googleapis.com/css?family=Orbitron:400,900' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Bree+Serif' rel='stylesheet' type='text/css'>
</head>
<body background="images/background.png">
    <div id="menu">
        <ul id="wrapper">
            <li>
                <input id="enterName" type="text" value="" title="Come on, be creative" placeHolder="Nick" maxlength="15" spellcheck="false">
            </li>
            <li>
                <input id="enterMapSize" type="text" value="" placeHolder="Map Size" maxlength="2">
            </li>
            <li>
                <select id="player"></select>
            </li>
            <li>
                <select id="shape">
                    <option>Rhombus</option>
                    <option>Rectangle</option>
                    <option>Hexagon</option>
                </select>
            </li>
            <li>
                <select id="biome">
                    <option>Forest</option>
                    <option>Desert</option>
                    <option>Mountain</option>
                </select>
            </li>
            <li>
                <button id="proceed">Next</button>
            </li>
        </ul>
    </div>
    <canvas id="myCanvas" resize>
        <div></div> <!-- menu here? -->
    </canvas>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="js/paper-full.js"></script>
    <script type="text/paperscript" canvas="myCanvas">

/*
to do:
1. map shapes
2. scale map to # of players
3. figure out what the hell to do with attacks
4. figure out how to remove frag aimer when not in use
5. figure out what the theme is
*/



    
$("#myCanvas").hide();

var size, biome, playerType, numPlayers = 2, gameSetup = 1, players = [], move = false, currentPlayer = 0, turnCounter = 0, moveCounter = 0;
var playerTypes = [// array of player types: add new player here
    {
        type: 'Scout',
        color: '#cc00cc',
        dice: 4,
        health: 10,
        cards: [// array of cards: put new cards here
            {
                attack: 5,
                defend: 3,
                rarity: 1
            }
        ]
    },
    {
        type: 'Heavy',
        color: '#ff0000',
        dice: 2,
        health: 50,
        cards: [// array of cards: put new cards here
            {
                attack: 3,
                defend: 5,
                rarity: 1
            }
        ]
    },
    {
        type: 'Fragger',
        color: '#e5e600',
        dice: 3,
        health: 30,
        cards: [// array of cards: put new cards here
            {
                attack: 3,
                defend: 5,
                rarity: 1
            }
        ],
        aimerLine: new Path()
    }
];



if (numPlayers + 1 === gameSetup) {
        $("#proceed").html('Start Game');
}

$("#player").hide();
$("#enterName").hide();

$("#proceed").click(function() {
    playerType = $("#player").val();
    biome = $("#biome").val();

    if (gameSetup === 1) {
        $("#enterMapSize").hide();
        $("#biome").hide();
        $("#shape").hide();

        $("#player").show();
        $("#enterName").show();
    }

    if (gameSetup > 1) {
        player = {
            nick: $("#enterName").val(),
            character: playerTypes[$("#player option:selected").index()],
            coord: {
                x: 5,
                y: (1 + gameSetup)
            },
            path: new Path.RegularPolygon(new Point(0,0),0,0),
            cards: [],//    put cards that the player can use in this array
            nameLabel: new PointText()
        };
        if (player.nick === '') {
            player.nick = 'Player ' + (gameSetup-1);
        }

        players.push(player);
    }


    if (numPlayers + 1 === gameSetup) {
        $("body").css('background-image', 'none');
        $("#menu").hide("slow");
        $("#myCanvas").show("slow");
        size = $("#enterMapSize").val();
        size = parseInt(size,10);
        setup();
    }

    $("#enterName").val('');

    gameSetup += 1;
});



for (var i = 0; i < playerTypes.length; i += 1) {//   add player types to select option in html code
    $("#player").append("<option>" + playerTypes[i].type + "</option>");
}



var boardMain = [];


function setup() {//           setup map here, also draw it
    var x = 200,y = 100;
    for (var i = 0; i < size; i += 1) {
        var row = [];
        for (var ii = 0; ii < size; ii += 1) {
            
            var type = randomTileType();

            var raster = new Raster({ // a raster is just an image and this is where the tile images are made ;)
                    position: new Point(x,y),
                    source: colorPicker(type)
            })

            var circle = new Shape.Circle(new Point(x,y), 60);//circle for in front of image
            circle.fillColor = new Color(0.5,0.5,05,0.3);
            circle.visible = false;

            var hexObject = {
                x: x, // x coord in pixels
                y: y, // y coord in pixels
                radius: 50, // radius of tile, i need to remember why we need this
                type: type, // type of tile i.e. forest, mountain
                path: raster, // image
                backgroundPath: circle // circle for in front of image
            };

            row.push(hexObject);
            x += 110;
        }
        boardMain.push(row);
        y += 95;
        x = (200-5*(i+1)) + (i+1) * 60;
    }
    for (var i = 0; i < players.length; i += 1) {
        var xP = boardMain[players[i].coord.y][players[i].coord.x].path.position.x;
        var yP = boardMain[players[i].coord.y][players[i].coord.x].path.position.y;
        players[i].path = new Path.RegularPolygon(new Point(xP, yP), 3, 30);
        players[i].path.fillColor = players[i].character.color;
        players[i].nameLabel = new PointText({
            point: players[i].path.position,
            justification: 'center',
            fontSize: 30,
            fillColor: 'white',
            content: players[i].nick
        });
    }
}

function colorPicker(type) {
    if (type === 'forest') {
        return 'images/grass.png';
    }
    else if (type === 'sand') {
        return 'images/desert.png';
    }
    else if (type === 'rock') {
        return 'images/rock.png';
    }
}
function lightColorPicker(type) {
    if (type === 'forest') {
        return '#00E34C';
    }
    else if (type === 'sand') {
        return '#ff9900';
    }
    else if (type === 'rock') {
        return '#BABABA';
    }
}

function randomTileType() {
    var randomTile = Math.floor((Math.random() * 6) + 1);
    if (biome === 'Forest') {
        if (randomTile <= 4) {
            return 'forest';
        } else if (randomTile === 5) {
            return 'sand';
        } else if (randomTile === 6) {
            return 'rock';
        }
    } else if (biome === 'Desert') {
        if (randomTile <= 4) {
            return 'sand';
        } else if (randomTile === 5) {
            return 'rock';
        } else if (randomTile === 6) {
            return 'forest';
        }
    } else if (biome === 'Mountain') {
        if (randomTile <= 4) {
            return 'rock';
        } else if (randomTile === 5) {
            return 'forest';
        } else if (randomTile === 6) {
            return 'sand';
        }
    }
}

function isNegative(number) {
    if (number > 0) {
        return true;
    } else if (number < 0) {
        return false;
    }
}

function isPlayerThereOrNah(x,y) {
    for (var i = 0; i < players.length; i += 1) {
        if (players[i].coord.x === x && players[i].coord.y === y) {
            return true;
        }
    }
    return false;
}

function canPlayerMoveOrNah(x,y) {

    var deltaX = x - players[currentPlayer].coord.x;
    var deltaY = y - players[currentPlayer].coord.y;

    if (players[currentPlayer].coord.x + moveCounter >= x && 
        players[currentPlayer].coord.y + moveCounter >= y && 
        players[currentPlayer].coord.x - moveCounter <= x && 
        players[currentPlayer].coord.y - moveCounter <= y && 
        (Math.abs(deltaX) + Math.abs(deltaY) <= moveCounter || (isNegative(deltaX) !== isNegative(deltaY) && (Math.abs(deltaY) <= moveCounter || Math.abs(deltaX) <= moveCounter))) && 
        isPlayerThereOrNah(x,y) === false) {

        return true;

    } 

    return false;
}

function onFrame(event) {
    if (turnCounter === 1) {
        for (var i = 0; i < size; i += 1) {//just trying to see where i can go
            for (var ii = 0; ii < size; ii += 1) {
                //   move events here

                boardMain[i][ii].backgroundPath.visible = false; // reset all tiles to non movable, then set them to movable don there\/

                if (canPlayerMoveOrNah(ii,i)) {

                    boardMain[i][ii].backgroundPath.visible = true;//  can move here

                } 
            }
        }
    } else if (turnCounter === 2) {
        for (var i = 0; i < size; i += 1) {//just trying to see where i can go 
            for (var ii = 0; ii < size; ii += 1) {
                //   move events here

                boardMain[i][ii].backgroundPath.visible = false;//  set all tiles to unshootable

                var deltaX = ii - players[currentPlayer].coord.x;
                var deltaY = i - players[currentPlayer].coord.y;

                if (ii === players[currentPlayer].coord.x || i === players[currentPlayer].coord.y || (ii - players[currentPlayer].coord.x)*(-1) === i - players[currentPlayer].coord.y) {

                    boardMain[i][ii].backgroundPath.visible = true; // set tiles to shootble

                } 
            }
        }
    }
}

function onMouseMove(event) {
    for (var i = 0; i < size; i += 1) {
        for (var ii = 0; ii < size; ii += 1) {
            if (boardMain[i][ii].path.contains(event.point)) {
                //   move events here

            } 
            
        }
    }
}

function onMouseDrag(event) {
    //if statement about if it is too far dragged or not
    for (var i = 0; i < size; i += 1) {
        for (var ii = 0; ii < size; ii += 1) {//  reposition tiles for the draging of the map

            boardMain[i][ii].backgroundPath.position.x += event.delta.x/3; // drag circles that highlight usable tiles: x coord
            boardMain[i][ii].backgroundPath.position.y += event.delta.y/3; // y ccord

            boardMain[i][ii].path.position.x += event.delta.x/3; // drag the tiles: x coord
            boardMain[i][ii].path.position.y += event.delta.y/3; // y coord

        }
        if (i < players.length) { // just using the board checker to also check the players
            players[i].path.position.x += event.delta.x/3; // move players when map is being drgged
            players[i].path.position.y += event.delta.y/3;
            players[i].nameLabel.position.x += event.delta.x/3; // move the name label
            players[i].nameLabel.position.y += event.delta.y/3;
        }
    }
}

function onMouseDown(event) {
    for (var i = 0; i < size; i += 1) {
        for (var ii = 0; ii < size; ii += 1) {
            if (boardMain[i][ii].path.contains(event.point)) {
                //click events here

                boardMain[i][ii].path.bounds.width -=10; // make the tile small when click down
                boardMain[i][ii].path.bounds.height -=10;
                
                console.log('x: ' + ii + '  y: ' + i);
                if (move === true) {
                    //   move math here
                }
            }
        }
    }
    if (button.contains(event.point)) { // this will go when the statbar is in place with the advance button
        button.fillColor = '#2576ef';
        button.strokeColor = '#75a8f5';
    }
}

function onMouseUp(event) {
    

    for (var i = 0; i < size; i += 1) {
        for (var ii = 0; ii < size; ii += 1) {

            if (boardMain[i][ii].path.bounds.width < 110) {// make the tile large again

                boardMain[i][ii].path.bounds.width +=10;
                boardMain[i][ii].path.bounds.height +=10;
            }

            if (boardMain[i][ii].path.contains(event.point)) {
                //   move events here
                
                

                if (turnCounter === 1) {
                    //console.log(ii + "  " + i)
                    var deltaX = ii - players[currentPlayer].coord.x;
                    var deltaY = i - players[currentPlayer].coord.y;

                    if (canPlayerMoveOrNah(ii,i)) {



                        //console.log("not even");

                        players[currentPlayer].path.position = boardMain[i][ii].path.position;
                        players[currentPlayer].nameLabel.position = boardMain[i][ii].path.position;
                        players[currentPlayer].coord.x = ii;
                        players[currentPlayer].coord.y = i;

                        moveCounter -= Math.abs(deltaX);

                        //boardMain[i][ii].path.strokeColor = '#A1A1A1';!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
                    } 
                }
            }
            if (turnCounter === 1) {
                   //boardMain[i][ii].path.fillColor = colorPicker(boardMain[i][ii].type); !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
            }
        }
    }

    if (button.contains(event.point)) {

        turnCounter++;

        if (turnCounter === 3) {
            turnCounter = 0;
            currentPlayer++;
        } else if (turnCounter === 1) {
            moveCounter = Math.floor((Math.random() * players[currentPlayer].character.dice) + 1);
        }


        if (currentPlayer === players.length) {
            currentPlayer = 0;
        }

        if (turnCounter === 0) {
            btnText.content = 'roll';
        } else if (turnCounter === 1) {
            btnText.content = 'action';
        } else if (turnCounter === 2) {
            btnText.content = 'next turn';
        }



    }

    button.fillColor = '#75a8f5';
    button.strokeColor = '#2576ef';
}


//---buttons---
var button = new Path.RegularPolygon(new Point(view.bounds.width - 100, 100), 3, 70);
button.fillColor = '#75a8f5';
button.strokeWidth = 6;
button.strokeColor = '#2576ef';

var btnText = new PointText({
    point: button.position,
    justification: 'center',
    fontSize: 30,
    fillColor: 'white',
    content: 'roll'
});



    </script>
</body>
</html>
